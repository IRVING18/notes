# 一、OSI七层网络构成(无数网传会表用)

- 物理层
    - 主要作用：通过电信号传输数据 
    - 数据单位：bit 比特
    - 主要设备：中继器、集线器、适配器
- 数据链路层
    - 在物理层提供的比特流服务基础上，建立数据链路，在信道上传输数据 
    - 数据单位：frame 帧
    - 主要设备：二层交换机、网桥
- 网络层
    - 通讯子网间通讯 
    - 数据单位：packet 包
    - 主要设备：路由器
    - 网络层协议代表：IP、IPX、RIP、ARP
- 传输层
    - 数据单位：TCP-segments 段，UDP-datagrams 数据报
    - 代表协议：TCP、UDP、SPX
- 会话层
    - 数据单位：报文 
    - 建立、管理、终止会话。（在五层模型里面已经合并到了应用层）
    - 对应主机进程，指本地主机与远程主机正在进行的会话
- 表示层
    - 主要作用：数据的表示、安全、压缩。（在五层模型里面已经合并到了应用层）
    - 格式有，JPEG、ASCll、EBCDIC、加密格式等 [2] 
- 应用层
    - 协议代表：FTP、HTTP、SNMP、Telnet   
    


# 二、TCP/IP 四层网络协议

- 网络接口层
    - 包含 OSI协议中：物理层、数据链路层
- 网络层
    - ip协议层 
- 运输层
    - TCP/UDP
- 应用层
    - 包含 OSI协议中：会话层、表示层、应用层 

#### 1.三次握手
![image](https://note.youdao.com/yws/public/resource/3f09e31005a042f55349f70f7a3fa451/xmlnote/WEBRESOURCE1914e70dc7e23ebd5191f23aa98d1228/3537)

file/网络/1

- syn :同步标识
- seq :序号
- ack :确认标识
- 为什么要三次握手？
    - 保证数据完整性
    - 防止服务器端开启一些无用的连接增加服务器开销
    - 防止已失效的连接请求报文段突然又传送到了服务端，因而产生错误
    - 这个过程可理解为：
![image](https://note.youdao.com/yws/public/resource/3f09e31005a042f55349f70f7a3fa451/xmlnote/WEBRESOURCE5e219ea77320f000cdcf855b2f43746f/3551)

file/网络/3
#### 2.四次挥手
![image](https://note.youdao.com/yws/public/resource/3f09e31005a042f55349f70f7a3fa451/xmlnote/WEBRESOURCE3960cf2b8922c1487fcdbe6601eefd15/3549)

file/网络/2

- 为什么需要四次挥手？
    - 因为在服务端接收到FIN 关闭请求时，可能还有尚未处理完的数据。所以服务端先返回ACK=1，此时客服端虽然已经发送关闭请求，不再发送数据，但仍可接收数据。所以服务端会将最后的数据传输完毕，然后再发送FIN结束标识。
> 1、建立连接时，被动方服务器端结束CLOSED阶段进入“握手”阶段并不需要任何准备，可以直接返回SYN和ACK报文，开始建立连接。  
> 2、释放连接时，被动方服务器，突然收到主动方客户端释放连接的请求时并不能立即释放连接，因为还有必要的数据需要处理，所以服务器先返回ACK确认收到报文，经过CLOSE-WAIT阶段准备好释放连接之后，才能返回FIN释放连接报文。

- 为什么客户端在TIME-WAIT阶段要等2MSL?
    - 为的是确认服务器端是否收到客户端发出的ACK确认报文
    - 当客户端发出最后的ACK确认报文时，并不能确定服务器端能够收到该段报文。所以客户端在发送完ACK确认报文之后，会设置一个时长为2MSL的计时器。
     - 服务器端在1MSL内没有收到客户端发出的ACK确认报文，就会再次向客户端发出FIN报文； 
    > MSL指的是Maximum Segment Lifetime：一段TCP报文在传输过程中的最大生命周期。2MSL即是服务器端发出为FIN报文和客户端发出的ACK确认报文所能保持有效的最大时长。
   